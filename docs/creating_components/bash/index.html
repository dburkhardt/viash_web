<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://viash.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://viash.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://viash.io/main.4b0469713aab9752c80292609d23e32fb157d468e532976b5545a71f3a3beb41776fec35c38b7e6c396b1df0f5c3cdabc155cd7daa8536330c78240b1092407a.css integrity="sha512-SwRpcTqrl1LIApJgnSPjL7FX1GjlMpdrVUWnHzo760F3b+w1w4t+bDlrHfD1w82rwVXNfaqFNjMMeCQLEJJAeg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Creating a Bash component - viash</title><meta name=description content="Developing a new viash component."><link rel=canonical href=https://viash.io/docs/creating_components/bash/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/doks.png"><meta name=twitter:title content="Creating a Bash component"><meta name=twitter:description content="Developing a new viash component."><meta name=twitter:site content="@DataIntuitive"><meta name=twitter:creator content="@DataIntuitive"><meta property="og:title" content="Creating a Bash component"><meta property="og:description" content="Developing a new viash component."><meta property="og:type" content="article"><meta property="og:url" content="/docs/creating_components/bash/"><meta property="og:image" content="/doks.png"><meta property="article:published_time" content="2021-05-28T14:00:00+00:00"><meta property="article:modified_time" content="2021-05-31T10:52:17+00:00"><meta property="og:site_name" content="viash"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/viash.io\/"},{"@type":"ListItem","position":3,"name":"Docs","item":"https:\/\/viash.io\/\/docs\/"},{"@type":"ListItem","position":4,"name":"Creating Components","item":"https:\/\/viash.io\/\/docs\/creating_components\/"},{"@type":"ListItem","position":5,"name":"Bash","item":"https:\/\/viash.io\/\/docs\/creating_components\/bash\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://viash.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://viash.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://viash.io/favicon-16x16.png><link rel=manifest href=https://viash.io/site.webmanifest><script async defer data-domain=viash.io src=https://plausible.io/js/plausible.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GDS2XT0DDG"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-GDS2XT0DDG')</script></head><body class="docs single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://viash.io/>viash</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/DataIntuitive><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/viash-io/viash><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class="nav-item active"><a class=nav-link href=https://viash.io/docs/prologue/introduction/>Docs</a></li><li class=nav-item><a class=nav-link href=https://viash.io/blog/>Blog</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Prologue</h3><ul class=list-unstyled><li><a class=docs-link href=https://viash.io/docs/prologue/introduction/>Introduction</a></li><li><a class=docs-link href=https://viash.io/docs/prologue/installation/>Installation</a></li><li><a class=docs-link href=https://viash.io/docs/prologue/supported_languages/>Supported languages</a></li><li><a class=docs-link href=https://viash.io/docs/prologue/hello_world_bash/>Hello World (Bash)</a></li><li><a class=docs-link href=https://viash.io/docs/prologue/hello_world_python/>Hello World (Python)</a></li><li><a class=docs-link href=https://viash.io/docs/prologue/hello_world_r/>Hello World (R)</a></li></ul><h3>Creating Components</h3><ul class=list-unstyled><li><a class="docs-link active" href=https://viash.io/docs/creating_components/bash/>Creating a Bash component</a></li><li><a class=docs-link href=https://viash.io/docs/creating_components/python/>Creating a Python component</a></li><li><a class=docs-link href=https://viash.io/docs/creating_components/r/>Creating an R component</a></li></ul><h3>Creating Pipelines</h3><ul class=list-unstyled><li><a class=docs-link href=https://viash.io/docs/creating_pipelines/platform-nextflow/>Creating a Nextflow Pipeline</a></li></ul><h3>Reference: Commands</h3><ul class=list-unstyled><li><a class=docs-link href=https://viash.io/docs/reference_commands/run/>viash run</a></li><li><a class=docs-link href=https://viash.io/docs/reference_commands/build/>viash build</a></li><li><a class=docs-link href=https://viash.io/docs/reference_commands/test/>viash test</a></li><li><a class=docs-link href=https://viash.io/docs/reference_commands/config-view/>viash config view</a></li><li><a class=docs-link href=https://viash.io/docs/reference_commands/ns-build/>viash ns build</a></li><li><a class=docs-link href=https://viash.io/docs/reference_commands/ns-test/>viash ns test</a></li><li><a class=docs-link href=https://viash.io/docs/reference_commands/ns-list/>viash ns list</a></li></ul><h3>Reference: Config</h3><ul class=list-unstyled><li><a class=docs-link href=https://viash.io/docs/reference_config/config/>Config file</a></li><li><a class=docs-link href=https://viash.io/docs/reference_config/functionality/>Functionality</a></li><li><a class=docs-link href=https://viash.io/docs/reference_config/platform-native/>Native Platform</a></li><li><a class=docs-link href=https://viash.io/docs/reference_config/platform-docker/>Docker Platform</a></li><li><a class=docs-link href=https://viash.io/docs/reference_config/platform-nextflow/>Nextflow Platform</a></li><li><a class=docs-link href=https://viash.io/docs/reference_config/file_formats/>Regarding file formats</a></li><li><a class=docs-link href=https://viash.io/docs/reference_config/config_mods/>Dynamic Config Modding</a></li></ul><h3>Help</h3><ul class=list-unstyled><li><a class=docs-link href=https://viash.io/docs/help/frequently_asked_questions/>Frequently Asked Questions</a></li></ul><h3>Contributing</h3><ul class=list-unstyled><li><a class=docs-link href=https://viash.io/docs/contributing/contributing_guidelines/>Contributing Guidelines</a></li><li><a class=docs-link href=https://viash.io/docs/contributing/conduct/>Code of Conduct</a></li><li><a class=docs-link href=https://viash.io/docs/contributing/dev_environment/>Dev Environment</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#write-a-script-in-bash>Write a script in bash</a></li><li><a href=#test-the-script>Test the script</a></li><li><a href=#describe-the-component-using-yaml>Describe the component using YAML</a><ul><li><a href=#defining-the-functionality>Defining the functionality</a></li><li><a href=#defining-the-platforms>Defining the platforms</a></li></ul></li><li><a href=#run-the-component>Run the component</a></li><li><a href=#building-an-executable>Building an executable</a></li><li><a href=#writing-and-running-a-unit-test>Writing and running a unit test</a></li><li><a href=#whats-next>What‚Äôs next?</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Creating a Bash component</h1><p class=lead>Developing a new viash component.</p><p>In this tutorial, you‚Äôll create a component that does the following:</p><ul><li>Extract all hyperlinks from a markdown file</li><li>Check if every URL is reachable</li><li>Create a text report with the results</li></ul><p>The component will be able to run locally and as a docker container. In
order to create a component you need two files: a script for the
functionality and a config file that describes the component.</p><p>The files used in this tutorial can be found here:</p><p><a href=https://github.com/viash-io/viash_web/tree/main/static/examples/md_url_checker>https://github.com/viash-io/viash_web/tree/main/static/examples/md_url_checker</a></p><h2 id=prerequisites>Prerequisites<a href=#prerequisites class=anchor aria-hidden=true>#</a></h2><p>To follow along with this tutorial, you need to have this software
installed on your machine:</p><ul><li>An <a href=https://viash.io/docs/prologue/installation>installation of viash</a>.</li><li>A <strong>Bash</strong> Unix shell.</li><li>An installation of <a href=https://www.docker.com/>Docker</a>.</li><li>An installation of <a href=https://curl.se/>cURL</a>. Install this via your
package manager if you don‚Äôt have it installed yet.</li></ul><p>We recommend you take a look at the <a href=https://viash.io/docs/prologue/hello_world_bash>hello world
example</a> first to understand how
components work.</p><h2 id=write-a-script-in-bash>Write a script in bash<a href=#write-a-script-in-bash class=anchor aria-hidden=true>#</a></h2><p>The first step of developing this component, is writing the core
functionality of the component, in this case a bash script.<br>Create a new folder named <strong>my_viash_component</strong> and open it. Now
create a new file named <strong>script.sh</strong> in there and add this code as its
content:</p><pre><code class=language-bash>#!/usr/bin/env bash

### 1 ###

## VIASH START

par_inputfile=&quot;Testfile.md&quot;
par_domain=&quot;https://viash.io&quot;
par_output=&quot;output.txt&quot;

## VIASH END

amount_of_errors=0

echo &quot;Extracting URLs&quot;

### 2 ###

# Extract the titles and URLs from the markdown file with sed and put them into arrays
readarray -t title_array &lt;&lt;&lt;$(sed -rn 's@^.*\[(.*)\]\((.*)\).*$@\1@p' $par_inputfile)
readarray -t url_array &lt;&lt;&lt;$(sed -rn 's@^.*\[(.*)\]\((.*)\).*$@\2@p' $par_inputfile)

# Get length of array
amount_of_urls=$(echo &quot;${#url_array[@]}&quot;)

echo &quot;Checking $amount_of_urls URLs&quot;

# Clear file
&gt;$par_output

### 3 ###

# Iterate over the array of titles and check each URL
for ((n = 0; n &lt; ${#title_array[*]}; n++)); do
    title=&quot;${title_array[n]}&quot;
    url=&quot;${url_array[n]}&quot;

    ### 4 ###

    # If an URL doesn't start with 'http', add the domain before it
    if [[ $url != http* ]]; then
        url=&quot;$par_domain${url_array[n]}&quot;
    fi

    echo &quot;$(($n + 1)): $url&quot;

    echo -e &quot;Link name: $title&quot; &gt;&gt;$par_output
    echo -e &quot;URL: $url&quot; &gt;&gt;$par_output

    ### 5 ###

    # Do a cURL and get the status code from the last response after following any redirects
    status_code=$(curl -ILs --max-redirs 5 $url | tac | grep -m1 HTTP)
    expected_code=&quot;200&quot;

    # Check if status code obtained via cURL contains the expected code
    if [[ $status_code == *$expected_code* ]]; then
        echo &quot;OK&quot;
        echo -e &quot;Status: OK, can be reached.&quot; &gt;&gt;$par_output
    else
        echo $status_code
        echo -e &quot;Status: ERROR! URL cannot be reached. Status code: $status_code&quot; &gt;&gt;$par_output
        amount_of_errors=$(($amount_of_errors + 1))
    fi

    echo -e &quot;---&quot; &gt;&gt;$par_output
done

echo &quot;&quot;
echo &quot;$par_inputfile has been checked and a report named $par_output has been generated.
$amount_of_errors of $amount_of_urls URLs could not be resolved.&quot;
</code></pre><p>Note the numbered comments scattered about looking like <code>### x ###</code>,
here‚Äôs a breakdown of the code:</p><ol><li>The variables are placed between <code>## VIASH START</code> and <code>## VIASH END</code>
for debugging purposes, their final values will be dynamically
generated by viash once the script is turned into a component. If
you want to skip the testing of your script, you can leave these out
and viash will create variables based on the configuration file.
There are three variables:<ul><li><code>par_inputfile</code>: The markdown file that needs to be parsed.</li><li><code>par_domain</code>: The domain URL that gets inserted before any
relative URLs. For example, ‚Äú/documentation/intro‚Äù could be
replaced with ‚Äú<a href=https://my-website/documentation/intro>https://my-website/documentation/intro</a>‚Äù to
create a valid URL.</li><li><code>par_output</code>: The path of the output text file that will contain
the report.</li></ul></li><li>The script parses the markdown file and extracts the hyperlink
titles and URLs using some nifty
<a href=https://www.gnu.org/software/sed/manual/sed.html>sed</a> regex. It
then puts those strings into two arrays for later use.</li><li>Start a for-loop to iterate the title array.</li><li>Any relative URLs (or those that don‚Äôt start with ‚Äúhttp‚Äù at least)
will get the domain added before it.</li><li>cURL is used to check for a response from the URL. The resulting
status code is stored and compared to the expected code. The results
get written to the terminal and the report.</li></ol><h2 id=test-the-script>Test the script<a href=#test-the-script class=anchor aria-hidden=true>#</a></h2><p>Before turning the script into a component, it‚Äôs a good idea to test if
it actually works as expected.<br>As the script expects a markdown file with hyperlinks, create a new file
in the script folder named <strong>Testfile.md</strong> and paste in the following:</p><pre><code class=language-markdown># Test File

This is a simple markdown file with some hyperlinks to test if the check_if_URLS_reachable component works correctly.
Some links to websites:

- [Google](https://www.google.com)
- [Reddit](https://www.reddit.com)
- [A broken link](http://microsoft.com/random-link)

Links that are relative to [viash.io](http://www.viash.io):

- You can [install viash here](/docs/prologue/installation).
- It all starts with a script and a [config file](/docs/reference_config/config) for your components.
</code></pre><p>Now open a terminal in the folder and execute the following command to
make your script executable:</p><pre><code class=language-bash>chmod +x ./script.sh
</code></pre><p>Next, run the script by executing this command:</p><pre><code class=language-bash>./script.sh
</code></pre><p>The script will now show the following output:</p><pre><code>Extracting URLs
Checking 6 URLs
1: https://www.google.com
OK
2: https://www.reddit.com
OK
3: http://microsoft.com/random-link
HTTP/2 404 
4: http://www.viash.io
OK
5: https://viash.io/docs/prologue/installation
OK
6: https://viash.io/docs/reference_config/config
OK

Testfile.md has been checked and a report named output.txt has been generated.
1 of 6 URLs could not be resolved.
</code></pre><p>If you get this same output, that means the script is working as
intended! Feel free to take a peek at the generated <strong>output.txt</strong> file
as well. You might have noticed you didn‚Äôt have to provide any
arguments, that‚Äôs because the values are hard-coded into the script for
debugging purposes.</p><p>Now the script has been tested, it‚Äôs time to create a config file to
describe the component based on it.</p><h2 id=describe-the-component-using-yaml>Describe the component using YAML<a href=#describe-the-component-using-yaml class=anchor aria-hidden=true>#</a></h2><p>A <strong>viash config file</strong> is a <a href=https://yaml.org/>YAML</a> file that
describes the behavior and supported platforms of a viash component.
Create new file named <strong>config.vsh.yaml</strong> and paste the following
template inside of it:</p><pre><code class=language-yaml>functionality:
  name: NAME
  description: DESCRIPTION
  arguments:                     
  - type: string
    name: --input
    description: INPUT DESCRIPTION
  resources:
  - type: LANGUAGE_script
    path: SCRIPT
platforms:
  - type: native
</code></pre><p>Every config file requires these two dictionaries:
<a href=https://viash.io/docs/prologue/hello_world_bash/#functionality>functionality</a> and
<a href=https://viash.io/docs/prologue/hello_world_bash/#platforms>platforms</a>. This bare-bones
config file makes it easy to ‚Äúfill in the blanks‚Äù for this example. For
more information about config files, you can take a look at the
<strong>Reference: Config</strong> section on the left.</p><p>Let‚Äôs start off by defining the functionality of our component.</p><h3 id=defining-the-functionality>Defining the functionality<a href=#defining-the-functionality class=anchor aria-hidden=true>#</a></h3><p>The <strong>functionality</strong> dictionary describes what the component does and
the resources it needs to do so. The first key is <strong>name</strong>, this will be
the name of the component once it‚Äôs built. Replace the <strong>NAME</strong> value
with <strong>md_url_checker</strong> or any other name of your choosing.</p><p>Next up is the <strong>description</strong> key, its value will be printed out at the
top when the <strong>‚Äìhelp</strong> command is called. Replace <strong>DESCRIPTION</strong> with
‚Äú<strong>Check if URLs in a markdown are reachable and create a text report
with the results.</strong>‚Äù. You can use multiple lines for a description by
starting its value with a pipe (|) and a new line, like so:</p><pre><code class=language-yaml>functionality:
  name: md_url_checker
  description: |
    This is the first line of my description.
    Here's a second line!
</code></pre><p>The <strong>arguments</strong> dictionary contains all of the arguments that are
accepted by the component. These arguments will be injected as variables
in the script. In the case of the example script, this are the variables
we‚Äôre working with:</p><ul><li><code>par_inputfile</code></li><li><code>par_domain</code></li><li><code>par_output</code></li></ul><p>To create good arguments, you need to ask yourself a few essential
questions about each variable:</p><ul><li>What is the most fitting <a href=https://viash.io/docs/reference_config/functionality/#arguments-list>data
type</a>?</li><li>Is it an input or an output?</li><li>Is it required?</li></ul><p>Let‚Äôs take a closer look at <code>par_inputfile</code> for starters:</p><p>We know it‚Äôs a file, as the script needs the path to a markdown <strong>file</strong>
as its <strong>input</strong>. It‚Äôs also definitely a <strong>required</strong> variable, as the
script would be pointless without it.<br>With this in mind, modify the first argument as follows:</p><ul><li>Change <strong>type</strong>‚Äôs value to <strong>file</strong>.</li><li>Set <strong>name</strong>‚Äôs value to <strong>‚Äìinputfile</strong>. The name of an argument has
to match the variable name as the argument will be injected into the
final script. In the case of <strong>bash</strong> scripts, the variable name
gets a <strong>‚Äòpar_‚Äô</strong> prefix add to it. This is the reason why the
script variables all start with <strong>‚Äòpar_‚Äô</strong>.</li><li>Use ‚Äú<strong>The input markdown file.</strong>‚Äù for the <strong>description</strong> value.
This description will be included when the <strong>‚Äìhelp</strong> option is
called.</li><li>Add a new key named <strong>required</strong> and set its value to <strong>true</strong>. This
ensures that the component will not be run without a value for this
argument.</li><li>Add another key, name it <strong>must_exist</strong> and set its value to
<strong>true</strong>. This key is unique to <strong>file</strong> type arguments, it adds
extra logic to the component to check if a file exists before
running the component. This saves you from having to do this check
yourself in the script.</li></ul><p>That‚Äôs it for the first argument! The result should look like this:</p><pre><code class=language-yaml>  - type: file
    name: --inputfile
    description: The input markdown file.
    required: true
    must_exist: true
</code></pre><p>Now for <code>par_domain</code>, this is a simple <strong>optional string</strong> that gets
added before relative URLs. Make room for a new argument by creating a
new line below <code>must_exist: true</code> and press <strong>Shift + Tab</strong> to back up
one tab so the cursor is aligned with the start of the first argument.
Add the <code>--domain</code> argument here:</p><pre><code class=language-yaml>  - type: string                           
    name: --domain
    description: The domain URL that gets inserted before any relative URLs. For example, &quot;/documentation/intro&quot; could be replaced with &quot;https://my-website/documentation/intro&quot; to create a valid URL.
</code></pre><p>If an argument isn‚Äôt required, you can simply omit the <strong>required</strong> key.
Again, the variable name in the script will get the **‚Äô_par‚Äô**
prefix added automatically in bash scripts. Here‚Äôs what the arguments
dictionary look like up until now:</p><pre><code class=language-yaml>  arguments:                     
  - type: file
    name: --inputfile
    description: The input markdown file.
    required: true
    must_exist: true
  - type: string                           
    name: --domain
    description: The domain URL that gets inserted before any relative URLs. For example, &quot;/documentation/intro&quot; could be replaced with &quot;https://my-website/documentation/intro&quot; to create a valid URL.
</code></pre><p>The final variable to create an argument for is <code>par_output</code>. This is
another <strong>file</strong> and clearly an <strong>output</strong>. Its value <strong>isn‚Äôt required</strong>
as we can use a <strong>default</strong> path if no explicit value is given.<br>Add yet another new argument with the following keys and values:</p><ul><li>Add a <strong>type</strong> key and set <strong>file</strong> as its value.</li><li>The next key is <strong>name</strong>, use <strong>‚Äìoutput</strong> as its value.</li><li>For the <strong>description</strong>, use ‚Äú<strong>The path of the output text file
that will contain the report.</strong>‚Äù.</li><li>Add a new key and name it <strong>default</strong>. This will act as the default
value when not specified by the user of the component. Set its value
to <strong>‚Äúoutput.txt‚Äù</strong>, including the quotation marks.</li><li>Finally, add the <strong>direction</strong> key and set its value to <strong>output</strong>.
This specifies the direction of an argument as either <strong>input</strong> or
<strong>output</strong>, with input being the default. Specifying that an
argument is an output is important so the component can correctly
handle the writing of files and the passing of values in a pipeline.</li></ul><p>The finished argument should look like this:</p><pre><code class=language-yaml>  - type: file                           
    name: --output
    description: The path of the output text file that will contain the report.
    default: &quot;output.txt&quot;
    direction: output
</code></pre><p>With that, there‚Äôs just one more part of the functionality to fill in:
the script itself!<br>Every viash component has one or more resources, the most important of
which is often the script. The template already contains a <strong>resources</strong>
dictionary, so replace the following values to point to the script:</p><ul><li>Set the value of <strong>type</strong> to <strong>bash_script</strong>. The script used in
this case was written in <strong>bash</strong>, so the resource type is set
accordingly so viash knows what flavor of code to generate to create
the final component. You can find a full overview of the different
resource types on the <a href=https://viash.io/docs/reference_config/functionality/#resources-list>Functionality
page</a>.</li><li>Change the value of <strong>path</strong> to <strong>script.sh</strong>. This points to the
resource and can be a relative path, an absolute path or even a URL.
In this case we keep the script in the same directory as the config
file to keep things simple.</li></ul><p>That finishes up the functionality side of the component! All that‚Äôs
left is defining the platforms with their dependencies and then running
and building the component.</p><h3 id=defining-the-platforms>Defining the platforms<a href=#defining-the-platforms class=anchor aria-hidden=true>#</a></h3><p>The platforms dictionary specifies the requirements to execute the
component on zero or more platforms. The list of currently supported
platforms are <a href=https://viash.io/docs/reference_config/platform-native>Native</a>,
<a href=https://viash.io/docs/reference_config/platform-docker>Docker</a>, and
<a href=https://viash.io/docs/reference_config/platform-nextflow>Nextflow</a>. If no platforms
are specified, a native platform is assumed. Here‚Äôs a quick overview of
the platforms:</p><ul><li><strong>native</strong>: The platform for developers that know what they‚Äôre doing
or for simple components without any dependencies. All dependencies
need to be installed on the system the component is run on.</li><li><strong>docker</strong>: This platform is recommended for most components. The
dependencies are resolved by using <a href=https://www.docker.com/>docker</a>
containers, either from scratch or by pulling one from a docker
repository. This has huge benefits as the end user doesn‚Äôt need to
have any of the dependencies installed locally.</li><li><strong>nextflow</strong>: This converts the component into a
<a href=https://www.nextflow.io/>NextFlow</a> module that can be imported
into a pipeline.</li></ul><p>In this tutorial, we‚Äôll take a look at both the native and docker
platforms. The platforms are also defined in the <strong>config.vsh.yaml</strong>
file at the very bottom. The native platform is actually already defined
in the template, that one <strong>type</strong> key with a value of <strong>native</strong> is
enough! Now for adding the docker platform, add a new line below the
last and add the following:</p><pre><code class=language-yaml>  - type: docker
    image: bash:latest
</code></pre><p>This tells viash that this component can be built to a docker container
with the <a href=https://hub.docker.com/_/bash>latest bash image</a> as its base.
If your script doesn‚Äôt depend on any packages, this would be all you‚Äôd
have to add when using a bash script. The script in our example however
needs <strong>curl</strong> installed to work. Luckily, this isn‚Äôt a problem since
viash <a href=https://viash.io/docs/reference_config/platform-docker/#example>supports defining
dependencies</a> which
then get pulled from inside the docker container before running the
script. To add curl as a dependancy that needs to be installed, add
these lines below <code>image: bash:latest</code>:</p><pre><code class=language-yaml>    setup:
      - type: apk
        packages: [ curl ]
</code></pre><p>This will prompt the
<a href=https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management>apk</a>
package manager to download and install curl inside of the container.
That‚Äôs it for the config! Be sure to save it and let‚Äôs move on to
actually running the component you‚Äôve created. For reference, you can
take a look at the completed <strong>config.vsh.yaml</strong> file in <a href=https://github.com/viash-io/viash_web/blob/main/static/examples/md_url_checker/config.vsh.yaml>our Github
repository</a>.</p><h2 id=run-the-component>Run the component<a href=#run-the-component class=anchor aria-hidden=true>#</a></h2><p>Time to run the component! First off, let‚Äôs see what the output of
<code>--help</code> is. To do that, open a terminal in the <strong>my_viash_component</strong>
folder and execute the following command:</p><pre><code class=language-bash>viash run config.vsh.yaml -- --help
</code></pre><p>This will show the following:</p><pre><code>Check if URLs in a markdown are reachable and create a text report with the results.

Options:
    --inputfile=file
        type: file, required parameter
        The input markdown file.

    --domain=string
        type: string
        The domain URL that gets inserted before any relative URLs. For example, /documentation/intro could be replaced with https://my-website/documentation/intro to create a valid URL.

    --output=file
        type: file, default: output.txt
        The path of the output text file that will contain the report.
</code></pre><p>As you can see, the values you entered into the config file are all
here.<br>Next, let‚Äôs run the component natively with some arguments. You can use
one of your own markdown files as the input if you desire. In that case,
replace <strong>Testfile.md</strong> in the command with the path to your file.<br>Execute the following command to run the component with the default
platform, in this case <strong>native</strong> as it‚Äôs the first in the <strong>platforms</strong>
dictionary:</p><pre><code class=language-bash>viash run config.vsh.yaml -- --inputfile=Testfile.md --domain=https://viash.io/ --output=my_report.txt
</code></pre><p>If all goes well, you‚Äôll see something like this output in the terminal
and a file named <strong>my_report.txt</strong> will have appeared:</p><pre><code>Extracting URLs
Checking 6 URLs
1: https://www.google.com
OK
2: https://www.reddit.com
OK
3: http://microsoft.com/random-link
HTTP/2 404 
4: http://www.viash.io
OK
5: https://viash.io//docs/prologue/installation
OK
6: https://viash.io//docs/reference_config/config
OK

Testfile.md has been checked and a report named my_report.txt has been generated.
1 of 6 URLs could not be resolved.
</code></pre><p>For more information on the run command, take a look at <a href=https://viash.io/docs/reference_commands/run/>the viash run
command page</a>. Great! With that working,
the next step is building an executable.</p><h2 id=building-an-executable>Building an executable<a href=#building-an-executable class=anchor aria-hidden=true>#</a></h2><p>You can generate an executable using either the native or the docker
platform. The former will generate a file that can be run locally, but
depends on your locally installed software packages to work. A docker
executable on the other hand can build and start up a docker container
that handles the dependencies for you.<br>To create a native build, execute the following command:</p><pre><code class=language-bash>viash build config.vsh.yaml
</code></pre><p>A new folder named <strong>output</strong> will have been created with an executable
inside named <strong>md_url_checker</strong>. To test it out, execute the following
command:</p><pre><code class=language-bash>output/md_url_checker --inputfile=Testfile.md --domain=https://viash.io/ --output=my_report.txt
</code></pre><p>The output is the same as by running the component, but the executable
can be easily shared and now includes the ability to feed arguments to
it and an included <code>--help</code> command. Not bad!<br>Next up is the docker executable. You can specify the platform with the
<code>-p</code> argument and choose an output folder using <code>-o</code>, apart from that
it‚Äôs the same as the previous build command:</p><pre><code class=language-bash>viash build -p docker -o docker_output config.vsh.yaml 
</code></pre><p>You‚Äôll now have a <strong>docker_ouput</strong> folder alongside the <strong>output</strong> one.
This folder also contains a file named <strong>md_url_checker</strong>, but its
inner workings are slightly different than before. Run
<strong>md_url_checker</strong> with the full arguments list to test what happens:</p><pre><code class=language-bash>docker_output/md_url_checker --inputfile=Testfile.md --domain=https://viash.io/ --output=my_report.txt
</code></pre><p>Here‚Äôs what just happened:</p><ul><li>If the docker image wasn‚Äôt found, viash will download it.</li><li>A check is made to see if a container named ‚Äúmd_url_checker‚Äù
exists. If not, one will be built with the image defined in the
config as its base.</li><li>All dependencies defined in the config are taken care of.</li><li>The script is run with the passed arguments and the output is passed
to your shell. The <strong>my_report.txt</strong> file is written to your
working directory.</li></ul><p>For more information about the <code>viash build</code> command, take a look at
<a href=https://viash.io/docs/reference_commands/build/>its command page</a>. That concludes the
building of executables based on components using viash!</p><h2 id=writing-and-running-a-unit-test>Writing and running a unit test<a href=#writing-and-running-a-unit-test class=anchor aria-hidden=true>#</a></h2><p>To finish off this tutorial, it‚Äôs important to talk about unit tests. To
ensure that your component works as expected during its development
cycle, writing one or more tests is essential. Luckily, writing a unit
test for a viash component is straightforward.</p><p>You just need to add test parameters in the config file and write a
script which runs the executable and verifies the output. When running
tests, viash will automatically build an executable and place it
alongside the other defined resources in a temporary working directory.
To get started, open up <strong>config.vsh.yaml</strong> file again and add this at
the end of the functionality dictionary, between the <code>path: script.sh</code>
and <code>platforms:</code> lines:</p><pre><code class=language-yaml>  tests:
  - type: bash_script
    path: test.sh
  - path: Testfile.md
</code></pre><p>This test dictionary contains a reference to the test script and all of
the files that need to be copied over in order to complete a test. In
the case of our example, <strong>test.sh</strong> will be the test script and
<strong>Testfile.md</strong> is necessary as an input markdown file is required for
the script to function. Now create a new file named <strong>test.sh</strong> in the
<strong>my_viash_component</strong> folder and add this as its content:</p><pre><code class=language-bash>set -ex # exit the script when one of the checks fail and output all commands.

# check 1
echo &quot;&gt;&gt;&gt; Checking whether output is correct&quot;

# run compononent with required input(s)
./md_url_checker --inputfile Testfile.md &gt; test-output.txt

[[ ! -f test-output.txt ]] &amp;&amp; echo &quot;Test output file could not be found!&quot; &amp;&amp; exit 1
grep -q '1: https://www.google.com' test-output.txt # Did the script find the URL?
grep -q 'HTTP/2 404' test-output.txt  # Did the web request return a 404 for the page that doesn't exist?

# check 2
echo &quot;&gt;&gt;&gt; Checking whether an output file was created correctly&quot;

[[ ! -f output.txt ]] &amp;&amp; echo &quot;Output file could not be found!&quot; &amp;&amp; exit 1
grep -q 'URL: https://www.google.com' output.txt # Was the URL written correctly in the report?
grep -q 'Status: ERROR! URL cannot be reached. Status code: HTTP/2 404' output.txt # Was the error written correctly in the report?
grep -q 'Link name: install viash here' output.txt # Was link name written correctly in the report?

echo &quot;&gt;&gt;&gt; Test finished successfully!&quot;
exit 0 # don't forget to put this at the end
</code></pre><p>This bash script will run the component and perform several checks to
its output. A successful test runs all the way down and exits with a <strong>0
exit code</strong>, any other code means a failure:</p><ul><li><code>set -ex</code> will stop the script once any of the lines fail and will
output all commands to the shell with a ‚Äò+‚Äô before it.</li><li><code>./md_url_checker --inputfile Testfile.md > test-output.txt</code> runs
the component and writes its output to a file.</li><li><code>[[ ! -f test-output.txt ]] && echo "Test output file could not be found!" && exit 1</code>
checks is the output file exists, if it doesn‚Äôt exit with a 1 code.</li><li>All of the <code>grep</code> calls check if a certain piece of text could be
found. Each of these calls can exit the script if the text wasn‚Äôt
found.</li><li>If everything succeeded, exit with a 0 code. Make sure not to forget
this final line in your own tests.</li></ul><p>Make sure both the config and test files are saved, then run a test by
running this command:</p><pre><code class=language-bash>viash test config.vsh.yaml 
</code></pre><p>The output will look like this:</p><pre><code>Running tests in temporary directory: '/tmp/viash_test_md_url_checker159892277392401116'
====================================================================
+/tmp/viash_test_md_url_checker159892277392401116/build_executable/md_url_checker ---setup
====================================================================
+/tmp/viash_test_md_url_checker159892277392401116/test_test.sh/test.sh
+ echo '&gt;&gt;&gt; Checking whether output is correct'
&gt;&gt;&gt; Checking whether output is correct
+ ./md_url_checker --inputfile Testfile.md
+ [[ ! -f test-output.txt ]]
+ grep -q '1: https://www.google.com' test-output.txt
+ grep -q 'HTTP/2 404' test-output.txt
+ echo '&gt;&gt;&gt; Checking whether an output file was created correctly'
&gt;&gt;&gt; Checking whether an output file was created correctly
+ [[ ! -f output.txt ]]
+ grep -q 'URL: https://www.google.com' output.txt
+ grep -q 'Status: ERROR! URL cannot be reached. Status code: HTTP/2 404' output.txt
+ grep -q 'Link name: install viash here' output.txt
+ echo '&gt;&gt;&gt; Test finished successfully!'
&gt;&gt;&gt; Test finished successfully!
+ exit 0
====================================================================
[32mSUCCESS! All 1 out of 1 test scripts succeeded![0m
Cleaning up temporary directory
</code></pre><p>If the test succeeds it simply writes the full output to the shell. If
there‚Äôs any issues, the script stops and an error message will appear in
red. For more information on tests take a look at the <a href=https://viash.io/docs/reference_commands/test/>viash test
command page</a>.</p><h2 id=whats-next>What‚Äôs next?<a href=#whats-next class=anchor aria-hidden=true>#</a></h2><p>Now you‚Äôre ready to use viash to creating components from your own
scripts, check out the rest of our documentation on the left. Here are
some good starting points:</p><ul><li>The <strong>Reference: Commands</strong> section on the left</li><li>An <a href=https://viash.io/docs/reference_config/functionality/>overview of the functionality
dictionary</a> of the config
file</li><li>More details about <a href=https://viash.io/docs/reference_config/platform-docker/>the docker
platform</a></li></ul><p class=edit-page><a href=https://github.com/viash-io/viash_web/blob/master/content/docs/creating_components/bash.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://viash.io/docs/prologue/hello_world_r/><div class="card my-1"><div class="card-body py-2">&larr; Hello World (R)</div></div></a><a class=ms-auto href=https://viash.io/docs/creating_components/python/><div class="card my-1"><div class="card-body py-2">Creating a Python component &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://www.netlify.com/>Netlify</a>, <a href=https://gohugo.io/>Hugo</a>, and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://viash.io/js/highlight.min.8cdbefd08ec63ef25f4b2510ae50c13b3d9ed43e25a15ddb55f14c33130e68cf8be3131ccf2d087c49f5f21fe88c2f0e2715a21f936047d0d0b85dc48cb864b9.js integrity="sha512-jNvv0I7GPvJfSyUQrlDBOz2e1D4loV3bVfFMMxMOaM+L4xMczy0IfEn18h/ojC8OJxWiH5NgR9DQuF3EjLhkuQ==" crossorigin=anonymous defer></script><script src=https://viash.io/main.min.cb1cfa565384689404329cbf8ad4a175b59ac6421a528ad947882d8242fc7b62b773cd5967a10349256154f6a67bcdeeb3da0729191ddd4f5623442999e53004.js integrity="sha512-yxz6VlOEaJQEMpy/itShdbWaxkIaUorZR4gtgkL8e2K3c81ZZ6EDSSVhVPame83us9oHKRkd3U9WI0QpmeUwBA==" crossorigin=anonymous defer></script><script src=https://viash.io/index.min.c4dcb39ecba663e225e30ab84e33eaea9e1a065a602d3da3b4da0eaf4ab1eede01e49fe06d3902cb4a66a8bae637c4573377319e3acaa6f9325bf331f1ee7c3f.js integrity="sha512-xNyznsumY+Il4wq4TjPq6p4aBlpgLT2jtNoOr0qx7t4B5J/gbTkCy0pmqLrmN8RXM3cxnjrKpvkyW/Mx8e58Pw==" crossorigin=anonymous defer></script></body></html>